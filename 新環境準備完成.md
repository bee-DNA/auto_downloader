# ✅ 新環境啟動準備完成

## 📦 系統狀態

**auto_downloader** 已完全準備好移至新環境使用！

### 📊 系統統計

- **總檔案數**: 102 個
- **總大小**: 103.73 MB
- **Python 檔案**: 4 個（含 config.py）
- **啟動腳本**: 2 個（SETUP.bat, START.bat）
- **文檔**: 12 個 Markdown 檔案
- **SRA Toolkit**: 3.2.1-win64（已內建）

---

## 🆕 新增啟動文檔

### 1. **新環境啟動指南.md** (7.93 KB)

完整的移植和啟動說明，包含：

- ✅ 環境需求檢查清單
- ✅ 詳細的 SETUP.bat 執行說明
- ✅ Python 套件說明（paramiko、tqdm）
- ✅ 故障排除指南
- ✅ 監控和進度檢查方法

### 2. **快速啟動卡.md** (2.20 KB)

一頁精簡版快速參考，包含：

- ✅ 2 步驟啟動流程
- ✅ 手動安裝套件指令
- ✅ 常見問題快速解決
- ✅ 下載統計摘要

---

## 🔧 SETUP.bat 已更新

### 新增功能

```batch
[3/4] 檢查Python環境與安裝套件...

✅ Python 3.x.x 已安裝

📦 安裝Python套件依賴...

⏳ 正在安裝 paramiko 和 tqdm...
pip install -r requirements.txt --upgrade

✅ Python套件安裝完成
   - paramiko: SFTP上傳到NAS
   - tqdm: 進度條顯示
```

### 改進說明

1. **自動安裝套件**: 使用 `pip install -r requirements.txt --upgrade`
2. **錯誤重試**: 如果失敗，自動執行 `pip install paramiko tqdm --upgrade --force-reinstall`
3. **清晰提示**: 顯示每個套件的用途
4. **版本顯示**: 自動顯示 Python 版本號

---

## 🚀 新環境啟動流程（最終版）

### 步驟 1️⃣: 移動資料夾

```
將整個 auto_downloader 資料夾複製到新電腦
（可壓縮為 ZIP，約 104 MB）
```

### 步驟 2️⃣: 確認環境

```
✅ Windows 10/11
✅ Python 3.7+（加入 PATH）
✅ pip 套件管理器
✅ 網路連線
✅ D: 磁碟至少 240 GB 空間
```

### 步驟 3️⃣: 執行 SETUP.bat

```powershell
cd auto_downloader
.\SETUP.bat
```

**自動完成**:

- 檢查必要檔案（runs.txt, download_progress.json）
- 安裝 Python 套件（paramiko, tqdm）
- 驗證 SRA Toolkit
- 顯示配置摘要

⏱️ **耗時**: 約 2-3 分鐘

### 步驟 4️⃣: 啟動下載

```powershell
.\START.bat
```

**自動執行**:

- 檢查 NAS 已完成的 114 個樣本
- 下載剩餘的 257 個樣本
- 6 個並行 × 5 線程（30 線程）
- 自動上傳到 NAS
- 自動清理本地檔案

⏱️ **耗時**: 約 28 小時

---

## 📋 下載統計（257 個樣本）

### 樣本分類

```
總樣本數: 606 個
├── 處理對象: 371 個 SRR
│   ├── ✅ NAS 已完成: 114 個（跳過）
│   └── ⏳ 需下載: 257 個 ← 只下載這些
└── 跳過: 235 個 ERR/DRR（非 NCBI）
```

### 時間估算

```
單個樣本平均: 6-7 分鐘
├── Prefetch: 20 分鐘（2.5 GB）
├── Fasterq-dump: 40 分鐘（5 線程）
├── 上傳 FASTQ: 15 分鐘（10 GB）
├── 上傳 SRA: 10 分鐘（2.5 GB）
└── 清理: 1 分鐘

6 個並行處理 = 257 ÷ 6 ≈ 43 批次
43 批次 × 40 分鐘 ≈ 28 小時
```

---

## 🐍 Python 套件說明

### 必須安裝（SETUP.bat 自動安裝）

#### 1. **paramiko >= 3.0.0**

- **用途**: SFTP 連接群暉 NAS
- **功能**:
  - 上傳 FASTQ 到 `/biodata_temp/raw_fastq/`
  - 上傳 SRA 到 `/biodata_temp/raw_sra_backup/`
  - 檢查 NAS 已完成的檔案
- **必需**: ✅ 是

#### 2. **tqdm >= 4.65.0**

- **用途**: 顯示下載和上傳進度條
- **功能**: 即時顯示百分比和 ETA
- **必需**: ⚠️ 推薦（沒有也能運作）

### 手動安裝（如果 SETUP.bat 失敗）

```powershell
# 方法 1: 使用 requirements.txt
pip install -r requirements.txt

# 方法 2: 直接安裝
pip install paramiko tqdm

# 方法 3: 升級現有套件
pip install --upgrade paramiko tqdm

# 驗證安裝
python -c "import paramiko; print(f'paramiko {paramiko.__version__}')"
python -c "import tqdm; print(f'tqdm {tqdm.__version__}')"
```

---

## 📖 文檔索引

### 啟動相關

1. **[快速啟動卡.md](快速啟動卡.md)** - 一頁精簡版（最適合新手）
2. **[新環境啟動指南.md](新環境啟動指南.md)** - 完整說明和故障排除
3. **[QUICK_START_NOW.md](QUICK_START_NOW.md)** - 原版快速開始

### 系統文檔

4. **[README.md](README.md)** - 主說明文件
5. **[QUICK_START.md](QUICK_START.md)** - 快速參考
6. **[FILES.md](FILES.md)** - 檔案清單
7. **[SOLUTION.md](SOLUTION.md)** - 技術方案

### 完成報告

8. **[COMPLETION_REPORT.md](COMPLETION_REPORT.md)** - 建置完成報告
9. **[MANIFEST.md](MANIFEST.md)** - 系統清單
10. **[README_COMPLETE.md](README_COMPLETE.md)** - 完成摘要
11. **[sratoolkit.README](sratoolkit.README)** - Toolkit 說明

---

## ⚙️ 系統配置（config.py）

### NAS 設定

```python
NAS_HOST = "bioailab.synology.me"
NAS_PORT = 10022
NAS_USERNAME = "guest_upload"
NAS_PASSWORD = "upload123"
NAS_BASE_PATH = "/biodata_temp"
```

### NCBI 設定

```python
NCBI_API_KEY = "cbc34d71d57af75c93952af5d6b51d58d008"
```

### 線程配置

```python
MAX_PARALLEL_SAMPLES = 6      # 同時處理 6 個樣本
THREADS_PER_SAMPLE = 5        # 每個樣本 5 線程解壓
# 總計 30 線程（解壓）+ 2 線程（系統）
```

### 工作目錄

```python
SRA_TEMP_DIR = "D:\\sra_temp"        # SRA 暫存（60 GB）
FASTQ_TEMP_DIR = "D:\\tmp"           # FASTQ 暫存（180 GB）
```

---

## 🔍 故障排除快速參考

| 錯誤訊息                      | 原因               | 解決方法                                 |
| ----------------------------- | ------------------ | ---------------------------------------- |
| `'python' 不是內部或外部命令` | Python 未加入 PATH | 重新安裝 Python 並勾選「Add to PATH」    |
| `pip install 失敗`            | pip 版本過舊       | `python -m pip install --upgrade pip`    |
| `prefetch.exe 無法執行`       | Toolkit 檔案缺失   | 確認 `sratoolkit.3.2.1-win64` 資料夾存在 |
| `Connection refused`          | NAS 連接問題       | 檢查網路和防火牆（埠 10022）             |
| `No space left on device`     | 磁碟空間不足       | 清理 D:\sra_temp 和 D:\tmp               |
| `import paramiko 失敗`        | 套件未安裝         | 執行 `pip install paramiko`              |

---

## ✅ 檢查清單

### 移動前

- [ ] 確認 auto_downloader 資料夾完整（102 檔案，103.73 MB）
- [ ] 備份 download_progress.json（進度記錄）
- [ ] 確認 config.py 中的 NAS 設定正確

### 新環境中（⚠️ 需手動準備）

- [ ] **Python 3.7+ 已安裝並在 PATH 中**
  - 下載：https://www.python.org/downloads/
  - 推薦：Python 3.10、3.11 或 3.12
  - ⚠️ 安裝時勾選「Add Python to PATH」
- [ ] pip 可以正常執行（隨 Python 附帶）
- [ ] 網路連線正常（可連 NCBI 和 NAS）
- [ ] D: 磁碟至少 240 GB 可用空間

### 啟動前

- [ ] 執行 `.\SETUP.bat` 完成初始化
- [ ] 確認 Python 套件安裝成功（paramiko、tqdm）
- [ ] 確認 SRA Toolkit 驗證通過

### 啟動後

- [ ] 終端顯示「檢查 NAS 已完成的檔案...」
- [ ] 顯示「跳過 NAS 已有的 114 個」
- [ ] 顯示「將下載 257 個樣本」
- [ ] 開始處理第一個樣本

---

## 🎯 最終摘要

### 系統狀態

✅ **完全獨立**: 包含所有工具（SRA Toolkit 3.2.1）  
✅ **自動安裝**: SETUP.bat 自動安裝 Python 套件  
✅ **完整文檔**: 12 個 Markdown 檔案涵蓋所有面向  
✅ **即插即用**: 移至新環境只需 2 步驟啟動

### 下載任務

🎯 **目標**: 257 個樣本（NAS 已有 114 個跳過）  
⏱️ **時間**: 約 28 小時  
💾 **磁碟**: D: 需 240 GB（會自動清理）  
☁️ **上傳**: 自動上傳 FASTQ 和 SRA 到 NAS

### 快速啟動

```powershell
# 步驟 1: 初始化（首次必須，約 2-3 分鐘）
.\SETUP.bat

# 步驟 2: 開始下載（約 28 小時）
.\START.bat
```

---

## 📞 需要幫助？

### 查看文檔

- **新手**: 先看 **[快速啟動卡.md](快速啟動卡.md)**
- **詳細**: 查看 **[新環境啟動指南.md](新環境啟動指南.md)**
- **技術**: 閱讀 **[SOLUTION.md](SOLUTION.md)**

### 檢查環境

```powershell
python check_environment.py
```

### 驗證套件

```powershell
python -c "import paramiko, tqdm; print('✅ 套件已安裝')"
```

---

**🚀 準備好了！執行 `.\SETUP.bat` 開始使用！**

---

_最後更新: 2025-10-19_  
_系統版本: auto_downloader v2.0 (30-thread optimized)_  
_文檔版本: 新環境啟動完整版_
