# 🚀 新環境執行指南

## ✅ **是的! auto_downloader 可以在新環境獨立執行!**

---

## 📦 需要準備的東西

### 必需項目

1. ✅ **Python 3.7+** (必須先安裝)
2. ✅ **auto_downloader 資料夾** (完整複製)
3. ✅ **sratoolkit.3.2.1-win64 資料夾** (SRA 工具)
4. ✅ **runs.txt** (606 個樣本清單,已包含)

### Python 套件

- `paramiko` (必需 - NAS 連接)
- `tqdm` (選用 - 進度條)

---

## 🎯 方法 1: 完整移植 (推薦)

### 步驟 1: 複製檔案

```
新電腦的任意位置/
├── data_collector/
│   ├── auto_downloader/           ← 複製這個資料夾
│   │   ├── config.py              ✅ 包含所有設定
│   │   ├── complete_downloader.py ✅ 主程式
│   │   ├── nas_uploader.py        ✅ NAS上傳器
│   │   ├── runs.txt               ✅ 樣本清單
│   │   ├── quick_check.py         ✅ 環境檢查
│   │   └── ... (其他工具檔案)
│   │
│   └── sratoolkit.3.2.1-win64/    ← 複製這個資料夾
│       └── bin/
│           ├── prefetch.exe
│           ├── fasterq-dump.exe
│           └── ...
```

**重要**: `sratoolkit.3.2.1-win64` 必須與 `auto_downloader` 在同一層!

### 步驟 2: 安裝 Python

1. 下載 Python: https://www.python.org/downloads/
2. 安裝時**勾選 "Add Python to PATH"**
3. 驗證安裝:
   ```powershell
   python --version
   ```

### 步驟 3: 安裝 Python 套件

```powershell
# 進入 auto_downloader 目錄
cd "你的路徑\data_collector\auto_downloader"

# 安裝必需套件
pip install paramiko tqdm
```

### 步驟 4: 驗證環境

```powershell
python quick_check.py
```

應該看到:

```
✅ Python 3.13.7
✅ SRA Toolkit 已就緒
✅ paramiko 已安裝
✅ 環境檢查通過!
```

### 步驟 5: 開始執行

```powershell
python complete_downloader.py
```

**完成!** 🎉

---

## 🎯 方法 2: 從零開始 (完整安裝)

### 步驟 1: 創建資料夾結構

```powershell
# 創建基本結構
mkdir C:\SRA_Downloader
cd C:\SRA_Downloader
mkdir data_collector
cd data_collector
```

### 步驟 2: 複製 auto_downloader

**選項 A: 從現有電腦複製**

- 複製整個 `auto_downloader` 資料夾到新位置

**選項 B: 使用 USB/雲端**

- 壓縮 `auto_downloader` 資料夾
- 傳輸到新電腦
- 解壓縮

### 步驟 3: 安裝 SRA Toolkit

```powershell
# 進入 auto_downloader 目錄
cd auto_downloader

# 執行自動安裝腳本
.\一鍵安裝_SRA_Toolkit.bat
```

或手動下載:

1. 訪問: https://github.com/ncbi/sra-tools/releases
2. 下載 `sratoolkit.3.2.1-win64.zip`
3. 解壓到 `data_collector` 目錄

### 步驟 4: 安裝 Python 套件

```powershell
pip install paramiko tqdm
```

### 步驟 5: 執行

```powershell
python complete_downloader.py
```

---

## 📋 快速檢查清單

執行前確認:

- [ ] Python 已安裝 (`python --version`)
- [ ] paramiko 已安裝 (`pip list | findstr paramiko`)
- [ ] auto_downloader 資料夾完整
- [ ] sratoolkit.3.2.1-win64 在正確位置
- [ ] runs.txt 存在 (606 行)
- [ ] config.py 中的 NAS 設定正確

執行檢查:

```powershell
python check_independence.py  # 檢查檔案完整性
python quick_check.py          # 檢查環境就緒
python verify_system.py        # 完整系統驗證
```

---

## 🔧 常見問題

### Q1: 沒有 sratoolkit.3.2.1-win64 怎麼辦?

```powershell
# 執行自動安裝
.\一鍵安裝_SRA_Toolkit.bat
```

或從原電腦複製整個 `sratoolkit.3.2.1-win64` 資料夾

### Q2: Python 套件安裝失敗?

```powershell
# 更新 pip
python -m pip install --upgrade pip

# 重新安裝
pip install paramiko tqdm --upgrade
```

### Q3: 找不到 prefetch.exe?

確認目錄結構:

```
你的路徑/
├── data_collector/
│   ├── auto_downloader/         ← 你在這裡執行
│   └── sratoolkit.3.2.1-win64/  ← SRA工具在這裡
│       └── bin/
│           └── prefetch.exe
```

### Q4: 需要修改設定嗎?

通常不需要! `config.py` 已包含:

- ✅ NCBI API Key
- ✅ NAS 連接設定
- ✅ 本地路徑配置
- ✅ 自動檢測 SRA Toolkit

如需修改,編輯 `config.py`

---

## 💾 需要複製的檔案清單

### 核心檔案 (必需)

```
auto_downloader/
├── config.py              ✅ 配置 (API Key, NAS設定)
├── complete_downloader.py ✅ 主程式
├── nas_uploader.py        ✅ NAS上傳器
├── runs.txt               ✅ 樣本清單 (606個)
├── quick_check.py         ✅ 環境檢查
├── verify_system.py       ✅ 系統驗證
├── fix_json.py            ✅ JSON修復
├── analyze_failures.py    ✅ 失敗分析
└── START.ps1              ✅ 啟動腳本
```

### SRA Toolkit (必需,在上層目錄)

```
data_collector/
└── sratoolkit.3.2.1-win64/
    └── bin/
        ├── prefetch.exe
        ├── fasterq-dump.exe
        └── vdb-validate.exe
```

---

## 🚀 一鍵啟動 (已設定好的環境)

```powershell
# 方式 1: PowerShell
.\START.ps1

# 方式 2: 直接執行
python complete_downloader.py

# 方式 3: 英文版
START_EN.bat
```

---

## 📊 執行流程預覽

```
1. 程式啟動
   ↓
2. 連接 NAS
   ↓
3. 檢查已有樣本 (120個)
   ↓
4. 計算需下載 (486個)
   ↓
5. 確認開始 (按 Enter)
   ↓
6. 自動下載、解壓、上傳
   - 6個樣本並行
   - 每個樣本約 10-30 分鐘
   - 自動續傳
   ↓
7. 完成! 🎉
```

---

## 🎁 額外功能

### 故障恢復

如果中斷,直接重新執行:

```powershell
python complete_downloader.py
```

程式會自動:

- ✅ 讀取進度記錄
- ✅ 跳過已完成樣本
- ✅ 繼續未完成工作

### 失敗分析

```powershell
python analyze_failures.py
```

### JSON 修復

```powershell
python fix_json.py
```

---

## ✅ 總結

**auto_downloader 是完全獨立的!**

**最簡單的移植**:

1. 複製 `auto_downloader` + `sratoolkit.3.2.1-win64`
2. 安裝 Python + paramiko
3. 執行 `python complete_downloader.py`

**就這麼簡單!** 🚀

---

## 📞 需要協助?

執行診斷:

```powershell
python check_independence.py  # 檢查檔案
python quick_check.py          # 檢查環境
python verify_system.py        # 完整驗證
```

所有檢查都通過 = 可以開始! ✅
