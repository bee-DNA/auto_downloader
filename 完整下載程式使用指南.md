# ğŸš€ å®Œæ•´ä¸‹è¼‰ç¨‹å¼ - é€Ÿåº¦å„ªåŒ–ç‰ˆ

## âœ… å·²å®Œæˆçš„æ•´åˆ

### 1. aria2 å¤šé€£æ¥ä¸‹è¼‰å™¨
- âœ… 16 å€‹ä¸¦è¡Œé€£æ¥åŒæ™‚ä¸‹è¼‰
- âœ… 3 å€‹ NCBI é¡åƒè‡ªå‹•åˆ‡æ›
- âœ… å¤±æ•—è‡ªå‹•å›é€€åˆ° prefetch
- âœ… é æœŸé€Ÿåº¦: 20-50 Mbpsï¼ˆæ¯”åŸæœ¬çš„ 5 Mbps å¿« 4-10 å€ï¼‰

### 2. æ™ºèƒ½ä¸‹è¼‰ç­–ç•¥
```python
if aria2 å¯ç”¨:
    ä½¿ç”¨ aria2 å¤šé€£æ¥ä¸‹è¼‰ï¼ˆå¿«é€Ÿï¼‰
    if æ‰€æœ‰é¡åƒéƒ½å¤±æ•—:
        å›é€€åˆ° prefetchï¼ˆç©©å®šï¼‰
else:
    ç›´æ¥ä½¿ç”¨ prefetch
    if Aspera å¯ç”¨:
        prefetch æœƒè‡ªå‹•ä½¿ç”¨ Aspera
```

---

## ğŸ¯ Docker å»ºæ§‹å®Œæˆå¾Œç«‹å³æ¸¬è©¦

### æ¸¬è©¦ 1: æª¢æŸ¥ aria2 æ˜¯å¦å®‰è£
```powershell
docker run --rm auto_downloader aria2c --version
```

**é æœŸè¼¸å‡º:**
```
aria2 version 1.36.0
...
```

---

### æ¸¬è©¦ 2: ä¸‹è¼‰å–®å€‹æ¨£æœ¬æ¸¬è©¦é€Ÿåº¦
```powershell
docker run --rm -v "${pwd}\data:/app/data" auto_downloader python -c "
from config import *
from complete_downloader import process_single_sample
from nas_uploader import NASUploader

nas = NASUploader(NAS_HOST, NAS_PORT, NAS_USER, NAS_PASSWORD, NAS_REMOTE_DIR)
process_single_sample('ERR372354', nas)
"
```

**è§€å¯Ÿè¼¸å‡º:**
- ğŸ” æŸ¥æ‰¾ `ğŸš€ ä½¿ç”¨ aria2 å¤šé€£æ¥åŠ é€Ÿä¸‹è¼‰ï¼ˆ16 é€£æ¥ï¼‰...`
- ğŸ” æŸ¥æ‰¾ `CN:16` è¡¨ç¤º 16 å€‹é€£æ¥
- ğŸ” æŸ¥æ‰¾ä¸‹è¼‰é€Ÿåº¦ï¼ˆæ‡‰è©²é¡¯ç¤º MB/sï¼‰

---

### æ¸¬è©¦ 3: æ‰¹æ¬¡ä¸‹è¼‰ï¼ˆæ­£å¼åŸ·è¡Œï¼‰

#### æ­¥é©Ÿ 3.1: æ¸…ç†ç•°å¸¸æª”æ¡ˆ
```powershell
python delete_extra_files.py
```
è¼¸å…¥ `yes` ç¢ºèªåˆªé™¤ 39 å€‹ä¸å®Œæ•´æª”æ¡ˆã€‚

#### æ­¥é©Ÿ 3.2: ä½¿ç”¨å„ªåŒ–é…ç½®ä¸‹è¼‰
```powershell
docker run --rm -v "${pwd}\data:/app/data" `
    -e RUNS_FILE=runs_to_fix.txt `
    -e MAX_WORKERS=8 `
    -e USE_ARIA2=yes `
    -e ARIA2_CONNECTIONS=16 `
    auto_downloader
```

**åƒæ•¸èªªæ˜:**
- `RUNS_FILE=runs_to_fix.txt`: åªä¸‹è¼‰ 42 å€‹éœ€è¦ä¿®å¾©çš„æ¨£æœ¬
- `MAX_WORKERS=8`: 8 å€‹æ¨£æœ¬ä¸¦è¡Œä¸‹è¼‰
- `USE_ARIA2=yes`: å•Ÿç”¨ aria2 åŠ é€Ÿ
- `ARIA2_CONNECTIONS=16`: æ¯å€‹æª”æ¡ˆ 16 å€‹é€£æ¥

**é è¨ˆæ™‚é–“:**
- ä½¿ç”¨ aria2: **1-2 å°æ™‚**
- ä¸ä½¿ç”¨ aria2: 5-6 å°æ™‚

---

## ğŸ“Š é€Ÿåº¦å°æ¯”

| ä¸‹è¼‰æ–¹å¼ | å–®æª”é€Ÿåº¦ | ä¸¦è¡Œæ•¸ | ç¸½ååé‡ | 42 æ¨£æœ¬æ™‚é–“ |
|---------|---------|--------|----------|------------|
| âŒ **prefetchï¼ˆèˆŠï¼‰** | 5 Mbps | 4 | 20 Mbps | ~10 å°æ™‚ |
| âš ï¸ **prefetch + ä¸¦è¡Œå„ªåŒ–** | 5 Mbps | 8 | 40 Mbps | ~5 å°æ™‚ |
| âœ… **aria2 + ä¸¦è¡Œï¼ˆæ–°ï¼‰** | 20-50 Mbps | 8 | 160-400 Mbps | **1-2 å°æ™‚** |

---

## ğŸ” ç›£æ§ä¸‹è¼‰é€²åº¦

### æ–¹æ³• 1: å³æ™‚æŸ¥çœ‹ Docker æ—¥èªŒ
```powershell
# é–‹å•Ÿæ–°çš„ PowerShell è¦–çª—
docker ps  # æ‰¾åˆ°å®¹å™¨ ID
docker logs -f <container_id>
```

### æ–¹æ³• 2: æª¢æŸ¥é€²åº¦æª”æ¡ˆ
```powershell
# å¦ä¸€å€‹è¦–çª—åŸ·è¡Œ
while ($true) {
    $progress = Get-Content download_progress.json | ConvertFrom-Json
    $total = $progress.runs.Count
    $completed = ($progress.runs.PSObject.Properties | Where-Object { $_.Value.status -eq "completed" }).Count
    Write-Host "é€²åº¦: $completed / $total"
    Start-Sleep -Seconds 30
}
```

### æ–¹æ³• 3: aria2 å…§å»ºé€²åº¦é¡¯ç¤º
aria2 æœƒå¯¦æ™‚é¡¯ç¤ºï¼š
```
[#1 SIZE:123.4MiB/456.7MiB(27%) CN:16 DL:45.2MiB ETA:2m15s]
```
- `SIZE`: å·²ä¸‹è¼‰/ç¸½å¤§å°
- `CN:16`: 16 å€‹é€£æ¥
- `DL:45.2MiB`: ç•¶å‰é€Ÿåº¦ 45.2 MB/sï¼ˆç´„ 361 Mbpsï¼ï¼‰
- `ETA:2m15s`: é è¨ˆå‰©é¤˜æ™‚é–“

---

## âš¡ é€²éšå„ªåŒ–é¸é …

### é¸é … A: å¦‚æœè¨˜æ†¶é«”å……è¶³ï¼Œå¢åŠ ä¸¦è¡Œæ•¸
```powershell
docker run --rm -v "${pwd}\data:/app/data" `
    -e MAX_WORKERS=12 `
    -e USE_ARIA2=yes `
    auto_downloader
```
**æ•ˆæœ:** 12 Ã— 30 Mbps = 360 Mbps ç¸½ååé‡

### é¸é … B: å¦‚æœå–®å€‹æª”æ¡ˆä¸‹è¼‰æ…¢ï¼Œå¢åŠ é€£æ¥æ•¸
```powershell
docker run --rm -v "${pwd}\data:/app/data" `
    -e ARIA2_CONNECTIONS=32 `
    auto_downloader
```
**æ•ˆæœ:** å–®æª”é€Ÿåº¦å¯èƒ½æå‡åˆ° 40-80 Mbps

### é¸é … C: å¹³è¡¡æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
```powershell
docker run --rm -v "${pwd}\data:/app/data" `
    -e MAX_WORKERS=6 `
    -e ARIA2_CONNECTIONS=24 `
    auto_downloader
```
**æ•ˆæœ:** æ›´å°‘ä¸¦è¡Œä½†æ›´å¿«çš„å–®æª”é€Ÿåº¦

---

## â“ ç–‘é›£æ’è§£

### Q1: aria2 é¡¯ç¤º "command not found"
**åŸå› :** Docker æ˜ åƒå°šæœªé‡å»º

**è§£æ±º:**
```powershell
docker build -t auto_downloader .
```

### Q2: aria2 ä¸‹è¼‰å¤±æ•—
**ç—‡ç‹€:** çœ‹åˆ° `âš ï¸ aria2 æ‰€æœ‰é¡åƒéƒ½å¤±æ•—ï¼Œå›é€€åˆ° prefetch...`

**åŸå› :** NCBI é¡åƒæš«æ™‚ä¸å¯ç”¨æˆ–ç¶²è·¯å•é¡Œ

**çµæœ:** ç¨‹å¼æœƒè‡ªå‹•å›é€€åˆ° prefetchï¼Œä¸å½±éŸ¿ä¸‹è¼‰

### Q3: é€Ÿåº¦ä»ç„¶åªæœ‰ 5 Mbps
**æª¢æŸ¥ 1:** ç¢ºèª aria2 æ˜¯å¦è¢«ä½¿ç”¨
```bash
# åœ¨æ—¥èªŒä¸­æœå°‹
grep "aria2" docker_logs.txt
```

**æª¢æŸ¥ 2:** ç¢ºèªç’°å¢ƒè®Šæ•¸
```powershell
docker run --rm auto_downloader bash -c "echo USE_ARIA2=\$USE_ARIA2"
```

**æª¢æŸ¥ 3:** æ‰‹å‹•æ¸¬è©¦ aria2
```powershell
docker run --rm auto_downloader aria2c --version
```

### Q4: Docker å»ºæ§‹è¶…é 20 åˆ†é˜
**åŸå› :** é¦–æ¬¡ä¸‹è¼‰ SRA Toolkitï¼ˆ130MBï¼‰å¾ˆæ…¢

**è§£æ±º:** 
- âœ… è®“å®ƒå®Œæˆï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
- âœ… ä¹‹å¾Œé‡å»ºåªéœ€ 30-60 ç§’
- æˆ–ä½¿ç”¨å…¶ä»–ç¶²è·¯ç’°å¢ƒå»ºæ§‹

---

## ğŸ“ å®Œæˆæª¢æŸ¥æ¸…å–®

å»ºæ§‹å‰:
- [ ] ç¢ºèªåœ¨æ­£ç¢ºç›®éŒ„: `d:\OneDrive\å­¸æ ¡ä¸Šèª²\èª²ç¨‹\å››ä¸Š\auto_downloader`
- [ ] ç¢ºèªå·²æ‹‰å–æœ€æ–°ä»£ç¢¼: `git pull`
- [ ] ç¢ºèª Docker Desktop æ­£åœ¨åŸ·è¡Œ

å»ºæ§‹ä¸­:
- [ ] åŸ·è¡Œ: `docker build -t auto_downloader .`
- [ ] ç­‰å¾…å®Œæˆï¼ˆé¦–æ¬¡ 15-25 åˆ†é˜ï¼‰
- [ ] çœ‹åˆ° `Successfully tagged auto_downloader:latest`

æ¸¬è©¦:
- [ ] æ¸¬è©¦ aria2: `docker run --rm auto_downloader aria2c --version`
- [ ] æ¸¬è©¦å–®å€‹æ¨£æœ¬ä¸‹è¼‰é€Ÿåº¦
- [ ] ç¢ºèªé€Ÿåº¦æå‡åˆ° 20+ Mbps

åŸ·è¡Œ:
- [ ] æ¸…ç†ç•°å¸¸æª”æ¡ˆ: `python delete_extra_files.py`
- [ ] æ‰¹æ¬¡ä¸‹è¼‰: `docker run --rm -v "${pwd}\data:/app/data" -e RUNS_FILE=runs_to_fix.txt -e USE_ARIA2=yes auto_downloader`
- [ ] ç›£æ§é€²åº¦å’Œé€Ÿåº¦

é©—è­‰:
- [ ] ä¸‹è¼‰å®Œæˆå¾ŒåŸ·è¡Œ: `python verify_and_fix_fastq.py`
- [ ] ç¢ºèª 896/896 æ¨£æœ¬å®Œæ•´
- [ ] éš¨æ©ŸæŠ½æŸ¥ 2-3 å€‹æª”æ¡ˆå¤§å°åˆç†

---

## ğŸ‰ é æœŸçµæœ

å®Œæˆå¾Œä½ æ‡‰è©²æœ‰:
1. âœ… **896 å€‹å®Œæ•´æ¨£æœ¬**ï¼ˆæ¯å€‹æœ‰ _1.fastq å’Œ _2.fastqï¼‰
2. âœ… **ä¸‹è¼‰é€Ÿåº¦æå‡ 4-10 å€**
3. âœ… **ç¸½æ™‚é–“ç¸®çŸ­åˆ° 1-2 å°æ™‚**ï¼ˆåŸæœ¬éœ€è¦ 10 å°æ™‚ï¼‰
4. âœ… **æ‰€æœ‰æª”æ¡ˆå·²ä¸Šå‚³åˆ° NAS**

**ç­‰ Docker å»ºæ§‹å®Œæˆå¾Œï¼Œç«‹å³é–‹å§‹æ¸¬è©¦ï¼** ğŸš€
